<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique des fiches</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">

<h1>ğŸ“š Historique des fiches</h1>

<div class="card">

<table class="table">
<thead>
<tr>
  <th>Client</th>
  <th>Appareil</th>
  <th>Date</th>
  <th>Actions</th>
</tr>
</thead>

<tbody id="list"></tbody>
</table>

</div>

<div class="center">
  <a class="link" href="index.html">â† Retour</a>
</div>

</div>

<!-- âœ… MODALE -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h2>DÃ©tails de la fiche</h2>

    <div id="modal-details"></div>

    <div class="modal-buttons">
      <button class="primary" onclick="window.print()">ğŸ–¨ï¸ Imprimer</button>
      <button class="secondary" onclick="fermerModal()">âœ– Fermer</button>
    </div>
  </div>
</div>

<script>
// AFFICHAGE HISTORIQUE
let h = JSON.parse(localStorage.getItem("historique") || "[]");
function afficher(){
  list.innerHTML="";
  h.forEach(f=>{
    list.innerHTML+=`
    <tr>
      <td>
        <strong>${f.nom}</strong><br>
        ğŸ“ <a href="tel:${f.tel}" class="phone">${f.tel}</a>
      </td>
      <td>${f.marque} ${f.modele || ""}</td>
      <td>${f.date}</td>
      <td>
        <button class="primary small-btn" onclick="voir(${f.id})">ğŸ‘ï¸ Voir</button>
        <button class="danger small-btn" onclick="supprimer(${f.id})">ğŸ—‘ï¸ Supprimer</button>
      </td>
    </tr>`;
  });
}
afficher();

// SUPPRESSION FICHE
function supprimer(id){
  if(!confirm("Supprimer cette fiche ?"))return;
  h = h.filter(f=>f.id!==id);
  localStorage.setItem("historique", JSON.stringify(h));
  afficher();
}

// MODALE
function voir(id){
  let f = h.find(x=>x.id===id);

  let b = f.boost ? "âœ… Rebooster SSD / RAM / Windows" : "âŒ Rebooster";
  let w = f.win11 ? "âœ… Mise Ã  niveau Windows 10 â†’ Windows 11" : "âŒ Mise Ã  niveau Windows 11";
  let s = (f.sauvegarde==="oui") ? 
    "âœ… Sauvegarde : " + f.sauvegardeElements.join(", ") :
    "âŒ Sauvegarde";

  document.getElementById("modal-details").innerHTML = `
    <p style="text-align:right; font-weight:600;">ğŸ“… ${f.date}</p>

    <p><strong>Client :</strong> ${f.nom}</p>
    <p><strong>TÃ©lÃ©phone :</strong> ${f.tel}</p>

    <p><strong>Appareil :</strong> ${f.type}</p>
    <p><strong>Marque :</strong> ${f.marque}</p>
    <p><strong>ModÃ¨le :</strong> ${f.modele}</p>

    <hr>

    <p><strong>Travaux demandÃ©s :</strong></p>
    <p>${b}</p>
    <p>${w}</p>
    <p>${s}</p>

    <hr>

    <p><strong>Description :</strong></p>
    <p>${f.probleme || "Aucune"}</p>
  `;

  modal.style.display="flex";
}

function fermerModal(){
  modal.style.display="none";
}
</script>

</body>
</html>
