<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique des dÃ©pÃ´ts</title>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAR8PVlerANOGdzNBwZjj81I6Ajtbn63eI",
  authDomain: "sosordi03-sav.firebaseapp.com",
  projectId: "sosordi03-sav"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function load(){
  let snap = await getDocs(query(collection(db,"fiches"), orderBy("date","desc")));
  let zone = document.getElementById("liste");

  snap.forEach(d=>{
    let f = d.data();
    let appareils = f.appareils.map(a=>`â€¢ ${a.type} â€” ${a.marque} ${a.modele}`).join("<br>");
    // travaux : si tableau -> afficher chaque item sur une ligne (ce que tu demandais)
    let travauxHtml = "Aucun";
    if(Array.isArray(f.travaux) && f.travaux.length){
      travauxHtml = "<ul style='margin:6px 0 0 16px;padding:0;'>";
      f.travaux.forEach(t=>{
        travauxHtml += `<li style="margin:4px 0;list-style:disc;">${t}</li>`;
      });
      travauxHtml += "</ul>";
    }

    let sauvegarde = (f.sauvegarde==="Oui") ? `Oui (${(f.sauvegardeItems||[]).join(", ")})` : `Non`;

    // Password (affichÃ© si prÃ©sent)
    let pwdHtml = "";
    if(f.password){
      pwdHtml = `<p>ğŸ” <strong>Mot de passe :</strong> ${f.password}</p>`;
    }

    zone.innerHTML += `
<div class="fiche-card" style="max-width:720px;">
  <h3>${f.nom} â€” ${f.tel}</h3>
  <small>ğŸ“… ${new Date(f.date).toLocaleDateString()}</small>

  <p>${appareils.replace(/â€¢/g, "ğŸ’»")}</p>
  <p>ğŸ’¾ <strong>Sauvegarde :</strong> ${sauvegarde}</p>
  <p>ğŸ”§ <strong>Travaux :</strong></p>
  ${travauxHtml}
  ${pwdHtml}
  <p>ğŸ“ <strong>ProblÃ¨me :</strong> ${f.probleme || ""}</p>
</div>`;
  });
}
load();
</script>

<style>
body{font-family:"Segoe UI",Arial;background:#e9edf3;padding:24px;}
h1{color:#143658;font-size:28px;margin-bottom:8px;}
.center{text-align:center;margin:14px 0;}
.link{text-decoration:none;color:#0078d7;font-weight:600;}
.fiche-card{
  background:#fff;
  padding:14px;
  border-radius:10px;
  border:1px solid #d9dfe8;
  margin-bottom:14px;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
}
</style>

</head>
<body>

<h1>ğŸ“š Historique des dÃ©pÃ´ts</h1>
<div class="center"><a href="index.html" class="link">â¬… Retour</a></div>

<div id="liste"></div>

</body>
</html>