<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique des dÃ©pÃ´ts</title>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAR8PVlerANOGdzNBwZjj81I6Ajtbn63eI",
  authDomain: "sosordi03-sav.firebaseapp.com",
  projectId: "sosordi03-sav"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function load(){
  let snap = await getDocs(query(collection(db,"fiches"), orderBy("date","desc")));
  let zone = document.getElementById("liste");

  snap.forEach(d=>{
    let f = d.data();
    let appareils = f.appareils.map(a=>`â€¢ ${a.type} â€” ${a.marque} ${a.modele}`).join("<br>");
    
    let travauxHtml = "Aucun";
    if(Array.isArray(f.travaux) && f.travaux.length){
      travauxHtml = "<ul style='margin:6px 0 0 16px;padding:0;'>";
      f.travaux.forEach(t=>{
        travauxHtml += `<li style="margin:4px 0;list-style:disc;">${t}</li>`;
      });
      travauxHtml += "</ul>";
    }

    let sauvegarde = (f.sauvegarde==="Oui") ? `Oui (${(f.sauvegardeItems||[]).join(", ")})` : `Non`;

    let pwdHtml = f.password ? `<p>ğŸ” <strong>Mot de passe :</strong><br>${f.password}</p>` : "";

    zone.innerHTML += `
<div class="fiche-card">
  <h3>${f.nom} â€” ${f.tel}</h3>
  <small>ğŸ“… ${new Date(f.date).toLocaleDateString()}</small>

  <p>ğŸ’» ${appareils}</p>
  <p>ğŸ’¾ <strong>Sauvegarde :</strong> ${sauvegarde}</p>

  <p>ğŸ› ï¸ <strong>Travaux :</strong></p>
  ${travauxHtml}

  ${pwdHtml}

  <p>ğŸ“ <strong>ProblÃ¨me :</strong><br>${f.probleme || ""}</p>
</div>`;
  });
}
load();
</script>

<style>
body{
  font-family:"Segoe UI",Arial;
  background:#e9edf3;
  padding:24px;
  text-align:center;
}

h1{
  color:#143658;
  font-size:28px;
  margin-bottom:8px;
}

.center{text-align:center;margin:14px 0;}
.link{text-decoration:none;color:#0078d7;font-weight:600;}

#liste{
  display:flex;
  flex-direction:column;
  align-items:center; /* âœ… centre les cartes */
  gap:20px;
  margin-top:16px;
}

.fiche-card{
  background:#fff;
  padding:18px;
  width:90%;
  max-width:420px; /* âœ… force le centrage propre */
  border-radius:12px;
  border:1px solid #d9dfe8;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
  text-align:left;
}
</style>

</head>
<body>

<h1>ğŸ“š Historique des dÃ©pÃ´ts</h1>
<div class="center"><a href="index.html" class="link">â¬… Retour</a></div>

<div id="liste"></div>

</body>
</html>