<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique des dÃ©pÃ´ts</title>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getFirestore, collection, getDocs, orderBy, query,
  deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAR8PVlerANOGdzNBwZjj81I6Ajtbn63eI",
  authDomain: "sosordi03-sav.firebaseapp.com",
  projectId: "sosordi03-sav"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// âœ… SUPPRESSION D'UNE FICHE
async function supprimerFiche(id) {
  if(!confirm("Voulez-vous supprimer cette fiche ?")) return;
  await deleteDoc(doc(db, "fiches", id));
  location.reload(); // recharge la page
}
window.supprimerFiche = supprimerFiche;

// âœ… CHARGEMENT DES FICHES
async function load(){
  let snap = await getDocs(query(collection(db,"fiches"), orderBy("date","desc")));
  let zone = document.getElementById("liste");

  snap.forEach(d=>{
    let f = d.data();
    let appareils = f.appareils.map(a=>`â€¢ ${a.type} â€” ${a.marque} ${a.modele}`).join("<br>");
    let travaux = (f.travaux?.length) 
  ? f.travaux.map(t => `<li>${t}</li>`).join("") 
  : "<li>Aucun</li>";

    let sauvegarde = (f.sauvegarde === "Oui") ? `Oui (${f.sauvegardeItems.join(", ")})` : "Non";

    zone.innerHTML += `
      <div class="fiche-card">
        <button class="delete-btn" onclick="supprimerFiche('${d.id}')">ğŸ—‘</button>

        <h3>${f.nom} â€” ${f.tel}</h3>
        <small>ğŸ“… ${new Date(f.date).toLocaleDateString()}</small>

        <p>${appareils.replace(/â€¢/g, "ğŸ’»")}</p>
        <p>ğŸ’¾ Sauvegarde : <strong>${sauvegarde}</strong></p>
        <p>ğŸ”§ Travaux :</p>
<ul style="margin:4px 0 8px 0; padding-left:20px;">
  ${travaux}
</ul>

        <p>ğŸ“ <strong>ProblÃ¨me :</strong> ${f.probleme}</p>
      </div>
    `;
  });
}
load();
</script>

<style>
/* âœ… Une seule colonne propre */

#liste {
  max-width: 700px;
  
  display: flex;
  flex-direction: column;
  gap: 22px;
}

/* Carte plus clean */
.fiche-card{
  position: relative;
  background:#fff;
  padding:16px 18px;
  border-radius:12px;
  border:1px solid #d9dfe8;
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
}

/* Bouton supprimer discret */
.delete-btn{
  position:absolute;
  top:10px;
  right:10px;
  background:none;
  border:none;
  font-size:20px;
  cursor:pointer;
  opacity:.6;
}
.delete-btn:hover{opacity:1;}




</style>
</head>

<body>

  <div class="container">
  
    <h1>ğŸ“š Historique des dÃ©pÃ´ts</h1>
  
    <div id="liste"></div>
  
    <div class="center" style="margin-top:30px;">
      <a href="index.html" class="link">â¬… Retour</a>
    </div>
  
  </div>
  
  </body>
  
</html>
