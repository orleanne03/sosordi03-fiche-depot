<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique des dÃ©pÃ´ts</title>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, orderBy, query, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAR8PVlerANOGdzNBwZjj81I6Ajtbn63eI",
  authDomain: "sosordi03-sav.firebaseapp.com",
  projectId: "sosordi03-sav"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function supprimerFiche(id){
  if(confirm("Supprimer cette fiche ?")){
    await deleteDoc(doc(db,"fiches",id));
    location.reload();
  }
}

async function load(){
  let snap = await getDocs(query(collection(db,"fiches"), orderBy("date","desc")));
  let zone = document.getElementById("liste");

  snap.forEach(d=>{
    let f = d.data();
    let appareils = f.appareils.map(a=>`â€¢ ${a.type} â€” ${a.marque} ${a.modele}`).join("<br>");
    let travaux = (f.travaux?.length) ? f.travaux.map(t=>`<li>${t}</li>`).join("") : "<li>Aucun</li>";
    let sauvegarde = (f.sauvegarde==="Oui") ? `Oui (${f.sauvegardeItems.join(", ")})` : "Non";
    let motdepasse = f.motdepasse ? f.motdepasse : "Non renseignÃ©";

    zone.innerHTML += `
<div class="fiche-card">
  <button class="delete-btn" onclick="supprimerFiche('${d.id}')">ğŸ—‘</button>
  <h3>${f.nom} â€” ${f.tel}</h3>
  <small>ğŸ“… ${new Date(f.date).toLocaleDateString()}</small>

  <p>ğŸ’» ${appareils}</p>
  <p>ğŸ’¾ <strong>Sauvegarde :</strong> ${sauvegarde}</p>

  <p>ğŸ› ï¸ <strong>Travaux :</strong></p>
  <ul>${travaux}</ul>

  <p>ğŸ”‘ <strong>Mot de passe :</strong> ${motdepasse}</p>

  <p>ğŸ“ <strong>ProblÃ¨me :</strong> ${f.probleme}</p>
</div>`;
  });
}

load();
</script>

<style>
body{
  font-family:"Segoe UI",Arial;
  background:#e9edf3;
  padding:22px;
  text-align:center;
}

h1{
  color:#143658;
  font-size:30px;
  margin-bottom:4px;
}

.center{text-align:center;margin:14px 0;}
.link{text-decoration:none;color:#0078d7;font-weight:600;}

#liste{
  margin-top:20px;
  display:flex;
  flex-direction:column;
  align-items:center; /* âœ… CARTES CENTRÃ‰ES */
  gap:18px;
}

.fiche-card{
  background:#fff;
  width:92%;
  max-width:420px; /* âœ… UNE COLONNE LARGE + LISIBLE */
  padding:18px;
  border-radius:12px;
  border:1px solid #d9dfe8;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
  text-align:left;
}
</style>

</head>

<body>

<h1>ğŸ“š Historique des dÃ©pÃ´ts</h1>
<div class="center"><a href="index.html" class="link">â¬… Retour</a></div>

<div id="liste"></div>

</body>
</html>