<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique - sosordi03</title>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
</head>
<body>

<div class="container">

<h1>ðŸ“š Historique des dÃ©pÃ´ts</h1>

<div class="card" id="list">Chargement...</div>

<div class="center">
  <a href="index.html" class="link">â¬… Retour</a>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAR8PVlerANOGdzNBwZjj81I6Ajtbn63eI",
  authDomain: "sosordi03-sav.firebaseapp.com",
  projectId: "sosordi03-sav",
  storageBucket: "sosordi03-sav.firebasestorage.app",
  messagingSenderId: "267775482168",
  appId: "1:267775482168:web:82a42975d8e24dd71a09cd"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function toggle(i){
  let c=document.getElementById("content-"+i);
  c.style.display=c.style.display==="none"?"block":"none";
}
window.toggle=toggle;

async function supprimer(id){
  if(!confirm("Supprimer ?")) return;
  await deleteDoc(doc(db,"fiches",id));
  location.reload();
}
window.supprimer=supprimer;

async function load(){
  const snap = await getDocs(collection(db,"fiches"));
  return snap.docs.map(d=>({id:d.id,...d.data()}));
}

load().then(h=>{
  if(h.length===0){
    list.innerHTML="<p style='text-align:center;color:#666;'>Aucune fiche enregistrÃ©e.</p>";
    return;
  }

  list.innerHTML=h.map((f,i)=>`
<div class="options-block" style="padding:14px;border-radius:10px;">
  <div onclick="toggle(${i})" style="display:flex;justify-content:space-between;cursor:pointer;">
    <div><strong>${f.nom}</strong> â€” ${f.tel}<br><span style="font-size:13px;">${new Date(f.date).toLocaleDateString()}</span></div>
    <div style="font-size:20px;">â®Ÿ</div>
  </div>

  <div id="content-${i}" style="display:none;margin-top:10px;">
    ${(f.appareils||[]).map(a=>`
     <strong>${a.type}</strong> â€” ${a.marque} ${a.modele||""}<br>
    `).join("")}
    <br><strong>ProblÃ¨me :</strong><br>${f.probleme||"(Non prÃ©cisÃ©)"}<br><br>
    <button class="danger small-btn" onclick="supprimer('${f.id}')">ðŸ—‘ Supprimer</button>
  </div>
</div>
`).join("");
});
</script>

</body>
</html>
